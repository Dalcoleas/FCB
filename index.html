<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Firebase Cloud Messaging</title>
</head>

<body>

    <h1>Firebase Cloud Messaging</h1>

    <h2>¿Qué es Firebase Cloud Messaging?</h2>

    <p>Es una solución de mensajería multiplataforma que te permite enviar mensajes de forma segura y gratuita.</p>

    <h2>¿Cómo funciona FCM?</h2>

    <p>Una implementación de FCM incluye dos componentes principales para enviar y recibir datos:
        Un entorno de confianza como Cloud Functions para Firebase o un servidor de apps para generar, orientar y
        enviar mensajes
        Una app cliente de iOS, Android o Web (JavaScript) que reciba mensajes
        Puedes enviar mensajes a través del SDK de Firebase Admin o los protocolos de servidor FCM. Para probar o
        enviar mensajes de participación o marketing con orientación y estadísticas integradas y potentes, puedes usar
        el Compositor de Notifications.
    </p>

    <h2>Funciones Clave de FCB</h2>

    <dl>
        <dt><b>Envía mensajes de notificación al usuario</b></dt>
    </dl>

    <dl>
        <dt><b>Orientación versátil de mensajes</b></dt>
        <dd>Distribuye mensajes a tu app cliente en cualquiera de las siguientes tres formas: a dispositivos
            individuales, a grupos de dispositivos o a dispositivos suscritos a temas.
        </dd>
    </dl>

    <dl>
        <dt><b>Envía mensajes desde apps cliente</b>
        </dt>
        <dd>Envía mensajes de confirmación, de chat y de otros tipos desde los dispositivos a tu servidor a través del
            canal de conexión confiable de FCM que consume poca batería.
        </dd>
    </dl>

    <h2>¿Cómo implementar Cloud Messaging?
    </h2>

    <h3>Los clientes FCM deben tener dispositivos Android 4.1 o más reciente. O un emulador que ejecute Android 4.1 con
        las API de Google.</h3>

    <p>Dependencias:
        implementation 'com.google.firebase:firebase-messaging:17.6.0'
    </p>

    <h3>Accede al token de registro de dispositivo
    </h3>

    <p>FirebaseInstanceId.getInstance().instanceId
        .addOnCompleteListener(OnCompleteListener { task ->
        if (!task.isSuccessful) {
        Log.w(TAG, "getInstanceId failed", task.exception)
        return@OnCompleteListener
        }

        // Get new Instance ID token
        val token = task.result?.token

        // Log and toast
        val msg = getString(R.string.msg_token_fmt, token)
        Log.d(TAG, msg)
        Toast.makeText(baseContext, msg, Toast.LENGTH_SHORT).show()
        })
    </p>

    <h3>Supervisa la generación del Token</h3>

    <p>Después de obtener el Token, puedes enviarlo a tu servidor de app:
    </p>

    <p>override fun onNewToken(token: String?) {
        Log.d(TAG, "Refreshed token: $token")

        sendRegistrationToServer(token)
        }
    </p>

</body>

</html>